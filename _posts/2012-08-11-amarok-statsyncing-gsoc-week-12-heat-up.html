---
layout: post
title: 'Amarok StatSyncing GSoC: week 12 - heat up your Last.fm accountz'
date: '2012-08-11T17:47:00.000+02:00'
author: strohel
tags:
- Amarok
- GSoC
- KDE
modified_time: '2012-08-11T18:11:45.330+02:00'
image: /images/2012-08-11-amarok-statsyncing-gsoc-week-12-heat-up-amarok-statsyncing-w12-1.png
blogger_id: tag:blogger.com,1999:blog-4406477566892767740.post-3648132854135857651
blogger_orig_url: https://strohel.blogspot.com/2012/08/amarok-statsyncing-gsoc-week-12-heat-up.html
---

<div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div>Hi, apart from packaging Amarok 2.6 (look forward to it!) I've also made significant progress on&nbsp;<a href="http://www.google-melange.com/gsoc/project/google/gsoc2012/strohel/15001">my GSoC project about statistics synchronization in Amarok</a>&nbsp;this week. In short, <b>2-way synchronization of your precious metadata with Last.fm works now</b>.<br />
<br />

<br />

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-owADmjc0rpo/UCZpdaeuFSI/AAAAAAAAAHY/HKuNNDqSHG8/s1600/amarok-statsyncing-w12-1.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="308" src="/images/2012-08-11-amarok-statsyncing-gsoc-week-12-heat-up-amarok-statsyncing-w12-1.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Notice that rating and labels are already synchronized.</td></tr></tbody></table><br />
This was the <b>last big milestone</b> of my project and I'm happy to have it completed just before GSoC's <i>suggested pencils-down</i> date. I must say that implementing all the Last.fm stuff was easier than expected, but that's probably because of the solid foundations of the framework that have been laid earlier. :-)<br />
<div class="separator" style="clear: both; text-align: center;"></div><br />
<br />

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-pEku7JEueRs/UCZpeEHzidI/AAAAAAAAAHc/YDVlLf1NA-k/s1600/amarok-statsyncing-w12-2.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="/images/2012-08-11-amarok-statsyncing-gsoc-week-12-heat-up-amarok-statsyncing-w12-2.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-size: small;">Compare with screenshots from earlier posts.</span></td></tr></tbody></table><br />
<b>What I've done this week:</b><br />
<ul style="font-family: inherit;"><li>Restructured internal code of&nbsp;StatSyncing::Controller to be even cleaner with regards to maintaining synchronizable collections.</li><li>Polished the UI of the <i>Choose Providers</i> dialog. It is much cleaner now and will make the KDE Usability team happy. See screenshot above.</li><li>Changed track matching to be case-insensitive. It would be a pity not to match 2 tracks just because the other one is not properly capitalized.</li><li>Implemented logic to synchronize labels across collections. For each track, you can tick which collections will be the sources of labels. Resulting labels are then the union of the checked ones.</li><li>Implemented matching with Last.fm tracks of your Last.fm Library; you have to have Last.fm plugin enabled and configured for this to work. Last.fm can match tracks by their artist, album and title.</li><li>Implemented reading of Last.fm metadata - it can provide play count and tags, and we use a trick to store rating using tags.</li><li>Implemented updating of Last.fm metadata - it can update tags and, with our little trick, even rating. See screenshot below.</li></ul><br />
<br />

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-HsTpmnfbUQA/UCZpe-iYu_I/AAAAAAAAAHk/mzp7d6j2nko/s1600/amarok-statsyncing-w12-3.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="196" src="/images/2012-08-11-amarok-statsyncing-gsoc-week-12-heat-up-amarok-statsyncing-w12-3.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">My Last.fm tags look like this now. :-)</td></tr></tbody></table><br />
<b>Problems I've faced:</b><br />
<ul style="font-family: inherit;"><li>First &amp; last play dates sadly aren't provided by Last.fm, although they have the data. Fortunately the framework is flexible enough to gracefully cope with them missing. But I'll try to convince Last.fm staff to include them in their web API.</li><li>liblastfm has a bug in its Track::removeTag method which breaks tag removal. <a href="https://github.com/eartle/liblastfm/pull/11">I've fixed it</a>, but the bug will hit you unless you use <a href="https://github.com/strohel/liblastfm/tree/track-removetag-fix">my liblastfm branch</a> or until liblastfm incorporates the pull request and releases it.</li></ul><b>The lasts bits left to do:</b><br />
<ul style="font-family: inherit;"><li>Buttons for mass-resolution of label conflicts in the <i>Matched Tracks</i> dialog.</li><li>Configuration option to exclude some labels from synchronization.</li><li>Option in the Last.fm plugin to opt-out from using the fancy rating tags.</li><li>Better error reporting. </li><li>Further polishing of the <i>Matched Tracks</i> dialog as suggested by the KDE Usability team.</li><li>Scrobbling tracks played on iPods to Last.fm - all support code is ready, I only need to devise an algorithm for guessing scrobble times (we only have last played time and play count). </li></ul>You can test my work by pulling and <a href="http://blogs.fsfe.org/myriam/archives/87">building</a> <a href="http://quickgit.kde.org/index.php?p=clones%2Famarok%2Flaitl%2Famarok.git&amp;a=shortlog&amp;h=refs/heads/gsoc">the gsoc branch</a> of <a href="http://quickgit.kde.org/?p=clones%2Famarok%2Flaitl%2Famarok.git&amp;a=summary">my Amarok git repository clone</a>. It works really well now! I also publish weekly diffs with more technical details on KDE's review board which may be a more convenient way to review my code and to comment on it: <a href="https://git.reviewboard.kde.org/r/105055/">week 1</a> <a href="https://git.reviewboard.kde.org/r/105100/">week 2</a> <a href="https://git.reviewboard.kde.org/r/105219/">week 3</a> <a href="https://git.reviewboard.kde.org/r/105280/">week 4</a> (week 5 done in â†’) <a href="https://git.reviewboard.kde.org/r/105409/">week 6</a> <a href="https://git.reviewboard.kde.org/r/105488/">week 7 (master bugfix)</a> <a href="https://git.reviewboard.kde.org/r/105610/">week 8 (master bugfix)</a> <a href="https://git.reviewboard.kde.org/r/105722/">week 9</a> <a href="https://git.reviewboard.kde.org/r/105919/">weeks 10 &amp; 11</a> <a href="https://git.reviewboard.kde.org/r/105979/">week 12</a>
