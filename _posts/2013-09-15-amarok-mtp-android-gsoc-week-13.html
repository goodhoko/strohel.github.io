---
layout: post
title: 'Amarok MTP (Android) GSoC week 13: Transcoding'
date: '2013-09-15T02:26:00.000+02:00'
author: strohel
tags:
- amarok
- gsoc
- kde
modified_time: '2013-09-15T02:35:03.556+02:00'
thumbnail: http://4.bp.blogspot.com/-Pr1wu6SrX1o/UjT9ydMcP-I/AAAAAAAAAv8/_sozkKSybRU/s72-c/GSoC2013-MTP-w13-transcodetracks.png
blogger_id: tag:blogger.com,1999:blog-4406477566892767740.post-5726760337311997064
blogger_orig_url: https://strohel.blogspot.com/2013/09/amarok-mtp-android-gsoc-week-13.html
---

<div class="separator" style="clear: both; text-align: center;"></div><div style="text-align: justify;">Hey, this is my 13th weekly report describing my work on my Google Summer of Code project to <a href="https://google-melange.appspot.com/gsoc/project/google/gsoc2013/strohel/32001">rewrite MTP (Android) support in Amarok from scratch</a>. The big item is week is <b>transcoding</b>.<br />
<br />

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-Pr1wu6SrX1o/UjT9ydMcP-I/AAAAAAAAAv8/_sozkKSybRU/s1600/GSoC2013-MTP-w13-transcodetracks.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="/images/2013-09-15-amarok-mtp-android-gsoc-week-13-GSoC2013-MTP-w13-transcodetracks.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">On-the-fly transcoding has come to Amarok's Android (MTP) collection.</td></tr></tbody></table><br />
</div>

<div style="text-align: justify;"><b>What I've done this week:</b></div>
<ul style="text-align: justify;">
<li>Implemented a little configuration dialog that shows some information and lets you set some preferences (more in the future). Accessible from Collection Browser:
</li>
</ul>

<table cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-G1yJFrD73J8/UjT6bOiDQBI/AAAAAAAAAvo/ibjN3kKKs-E/s1600/GSoC2013-MTP-w13-collectionbar.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="/images/2013-09-15-amarok-mtp-android-gsoc-week-13-GSoC2013-MTP-w13-collectionbar.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">The little wrench opens the configuration dialog.</td></tr></tbody></table>
<br />

<ul style="text-align: justify;">
<li>Implemented support for renaming the device (setting friendly name). The name is actually sent to the device and is also picked up by kio-mtp etc.</li></ul><ul style="text-align: justify;">

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-03NC1BC_vGg/UjT49Pdia8I/AAAAAAAAAvY/isjEM4ItEyE/s1600/GSoC2013-MTP-w13-configdialog.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="/images/2013-09-15-amarok-mtp-android-gsoc-week-13-GSoC2013-MTP-w13-configdialog.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">MTP device configuration dialog. Notice the Transcode label.</td></tr></tbody></table><br />

<li>Implemented on-the-fly transcoding when copying/moving tracks to the device, yay! Your transcoding preferences can optionally be remembered (as is usual in Amarok) and the encoding even makes use of more than one of your processor cores. See:</li></ul>

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-DZ6nnqNIyyg/UjT7ztMQFdI/AAAAAAAAAvw/abldNE7RDdo/s1600/GSoC2013-MTP-w13-transcoding.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="/images/2013-09-15-amarok-mtp-android-gsoc-week-13-GSoC2013-MTP-w13-transcoding.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">This is the proof that transcoding works. :-)</td></tr></tbody></table><br />

<ul style="text-align: justify;"><li>Done small tweaks like correctly releasing the device when Amarok is closed, trying not to confuse user, improving feedback...</li></ul><ul></ul><b>Problems I've faced:</b><br />
<ul><li style="text-align: justify;">A known bug where transcoding a track with embedded cover image creates a <i>video</i> ogg file, the metadata thereof (most importantly file size) are then refused to be read by Amarok.</li><li style="text-align: justify;">Infinite loop in libmtp when the actual size of the file you want to upload is different than what you claim. Complements interestingly the above bug.</li></ul><b>What's next:</b><br />
<ul><li style="text-align: justify;">Ability to see &amp; specify file structure of the on-device tracks.</li><li>Polishing.</li></ul><div style="text-align: justify;">You can view and test my code by checking out <a href="http://quickgit.kde.org/?p=clones%2Famarok%2Flaitl%2Famarok.git&amp;a=shortlog&amp;h=gsoc">gsoc branch of my personal Amarok clone repository</a>.</div>
