---
layout: post
title: 'Amarok MTP (Android) GSoC: weeks 6 & 7'
date: '2013-08-05T19:50:00.000+02:00'
author: strohel
tags:
- amarok
- gsoc
- kde
modified_time: '2013-08-05T19:50:46.225+02:00'
blogger_id: tag:blogger.com,1999:blog-4406477566892767740.post-2909506625390965435
blogger_orig_url: https://strohel.blogspot.com/2013/08/amarok-mtp-android-gsoc-weeks-6-7.html
---

<div style="text-align: justify;">I was so busy coding in the last 2 weeks that I forgot a write a report. Here comes a combined report for weeks 6 and 7 concerning work on my Google Summer of Code project to <a href="https://google-melange.appspot.com/gsoc/project/google/gsoc2013/strohel/32001">rewrite MTP (Android) support in Amarok from scratch</a>.<br /></div><div style="text-align: justify;"><b>What I've done this week:</b></div><ul><li style="text-align: justify;">Changed MTP track cache path to be the "cache" directory (usually "/var/tmp/kdecache-$username/") instead of the "tmp" directory (usually /tmp/kde-$username/). The cache can get very big (gigabytes) in extreme cases and /tmp might be a size-constrained memory-backed filesystem.</li><li style="text-align: justify;">Added code to explicitly remove stale files in MTP track cache. The relevant files are normally removed when the associated track is not referenced any more (i.e. when the device in unplugged), but for example when a MTP track remains in the playlist, it may be still referenced at the time Amarok quits.</li><li style="text-align: justify;">Introduced support for keeping per-device MTP collection configuration (not yet represented in the UI).</li><li style="text-align: justify;">Added first configuration option and associated feature: reading and writing file tags (in addition to MTP metadata; useful because at least my Samsung S II mini doesn't seem to be able to extract year and track number out of some files). This means that when a track file is available, tags are read from it, enhancing existing (MTP) tags. In future, it will work conversely when metadata are edited.</li><li style="text-align: justify;">The trick from the <a href="http://strohel.blogspot.com/2013/07/amarok-mtp-android-gsoc-week-5.html">previous post</a> worked - track playback is started as soon as ~1 MB of it is cached. This means that playing even hours-long pieces straight off the devices should be instant.</li><li style="text-align: justify;">Finally implemented edit-ability of MTP track metadata. It means that you can edit track tags in Amarok and it will tell the device to change them. See also <i>What's next</i>.</li></ul><b>What's next:</b><br /><ul><li style="text-align: justify;">According to my testing, at least my S III mini is able to remember track metadata we send to it, but it doesn't write it down to the actual files. I'll implement optional support to download, change and upload the file in metadata change.</li><li style="text-align: justify;">Implementing a small dialog with configuration options and some device &amp; troubleshooting info.</li></ul>You can view and test my code by checking out <a href="http://quickgit.kde.org/?p=clones%2Famarok%2Flaitl%2Famarok.git&amp;a=shortlog&amp;h=gsoc">gsoc branch of my personal Amarok clone repository</a>.